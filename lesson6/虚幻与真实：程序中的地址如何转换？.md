## 虚拟地址转换物理地址
**把虚拟地址空间和物理地址空间都分成同等大小的块，也称为页，按照虚拟页和物理页进行转换。**根据软件配置不同，这个页的大小可以设置为 4KB、2MB、4MB、1GB，这样就进入了现代内存管理模式 ———— **分页模型**。

![](https://wsmcs.cn/wp-content/uploads/2023/02/post-339-63eb7c9937e86.)

## CPU 地址转换图
![](https://wsmcs.cn/wp-content/uploads/2023/02/post-339-63eb800f4a8bc.)

## MMU页表原理图
![](https://wsmcs.cn/wp-content/uploads/2023/02/post-339-63eb8010c976e.)
第一个位段索引顶级页目录中一个项，该项指向一个中级页目录，然后用第二个位段去索引中级页目录中的一个项，该项指向一个页目录，再用第三个位段去索引页目录中的项，该项指向一个物理页地址，最后用第四个位段作该物理页内的偏移去访问物理内存。这就是 MMU 的工作流程。


## 保护模式下的分页
分页模式的**灵活性、通用性、安全性**，是现代操作系统内存管理的基石

### 4KB 页
该分页方式下，32 位虚拟地址被分为三个位段：页目录索引、页表索引、页内偏移，只有一级页目录，其中包含 1024 个条目 ，每个条目指向一个页表，每个页表中有 1024 个条目。其中一个条目就指向一个物理页，每个物理页 4KB。这正好是 4GB 地址空间。如下图所示
![](https://wsmcs.cn/wp-content/uploads/2023/02/post-339-63eb80115fbdb.)

### 4MB 页
该分页方式下，32 位虚拟地址被分为两个位段：页表索引、页内偏移，只有一级页目录，其中包含 1024 个条目。其中一个条目指向一个物理页，每个物理页 4MB，正好为 4GB 地址空间，如下图所示。
![](https://wsmcs.cn/wp-content/uploads/2023/02/post-339-63eb8011a1612.)

## 长模式下的分页
如果开启了长模式，则必须同时开启分页模式，因为长模式弱化了分段模型，而分段模型也确实有很多不足，不适应现在操作系统和应用软件的发展。

### 4KB 页
该分页方式下，64 位虚拟地址被分为 6 个位段，分别是：保留位段，顶级页目录索引、页目录指针索引、页目录索引、页表索引、页内偏移，顶级页目录、页目录指针、页目录、页表各占有 4KB 大小，其中各有 512 个条目，每个条目 8 字节 64 位大小，如下图所示。
![](https://wsmcs.cn/wp-content/uploads/2023/02/post-339-63eb8011d96cc.)

### 2MB 页
在这种分页方式下，64 位虚拟地址被分为 5 个位段 ：保留位段、顶级页目录索引、页目录指针索引、页目录索引，页内偏移，顶级页目录、页目录指针、页目录各占有 4KB 大小，其中各有 512 个条目，每个条目 8 字节 64 位大小。
![](https://wsmcs.cn/wp-content/uploads/2023/02/post-339-63eb801232fd1.)






